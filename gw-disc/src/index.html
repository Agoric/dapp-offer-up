<!DOCTYPE html>
<html>
  <head>
    <title>My Discord OAuth2 App</title>
  </head>
  <body>
    <!-- https://discordjs.guide/oauth2/#implicit-grant-flow -->
    <div id="info">Hoi!</div>
    <a
      id="login"
      style="display: none"
      href="https://discord.com/api/oauth2/authorize?client_id=1172990280878788688&redirect_uri=http%3A%2F%2Flocalhost%3A50451&response_type=token&scope=identify"
      >Identify Yourself</a
    >

    <script type="module">
      import { NonNullish, parseAuthInfo, getUserInfo } from './gw-ui.js';

      const $ = id => document.getElementById(id);

      window.onload = async () => {
        const elt = {
          login: NonNullish($('login')),
          info: NonNullish($('info')),
        };

        const creds = parseAuthInfo(window.location.hash);
        if (!creds.accessToken) {
          elt.login.style.display = 'block';
          return;
        }

        const { username, id } = await getUserInfo(creds, { fetch });
        elt.info.innerText += ` ${username} / ${id}`;
      };
    </script>
  </body>
</html>
